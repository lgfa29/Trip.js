(function(window,$){var Trip=function(tripData,userOptions){this.settings=$.extend({tripIndex:0,tripTheme:"black",backToTopWhenEnded:false,overlayZindex:99999,delay:1e3,enableKeyBinding:true,showCloseBox:false,skipUndefinedTrip:false,showNavigation:false,canGoNext:true,canGoPrev:true,nextLabel:"Next",prevLabel:"Back",finishLabel:"Dismiss",closeBoxLabel:"&#215;",onTripStart:$.noop,onTripEnd:$.noop,onTripStop:$.noop,onTripChange:$.noop},userOptions);this.tripData=tripData;this.$tripBlock=null;this.$overlay=null;this.$bar=null;this.$root=$("body, html");this.tripIndex=this.settings.tripIndex;this.tripDirection="next";this.timer=null;this.progressing=false;this.hasExpose=false;this.CONSTANTS={LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ESC:27,SPACE:32};this.console=window.console||{}};Trip.prototype={preInit:function(){if(typeof this.console==="undefined"){var self=this,methods=["log","warn","debug","info","error"];$.each(methods,function(i,methodName){self.console[methodName]=$.noop})}},showExpose:function($sel){this.hasExpose=true;var oldCSS,newCSS;oldCSS={position:$sel.css("position"),zIndex:$sel.css("z-Index")};newCSS={position:"relative",zIndex:this.settings.overlayZindex+1};$sel.data("trip-old-css",oldCSS).css(newCSS).addClass("trip-exposed");this.$overlay.show()},hideExpose:function(){this.hasExpose=false;var $exposedSel=$(".trip-exposed"),oldCSS=$exposedSel.data("trip-old-css");$exposedSel.css(oldCSS).removeClass("trip-exposed");this.$overlay.hide()},bindResizeEvents:function(){var that=this;$(window).on("resize",function(){that.run()})},bindKeyEvents:function(){var that=this;$(document).on({"keydown.Trip":function(e){that.keyEvent.call(that,e)}})},unbindKeyEvents:function(){$(document).off("keydown.Trip")},keyEvent:function(e){switch(e.which){case this.CONSTANTS["ESC"]:this.stop();break;case this.CONSTANTS["SPACE"]:e.preventDefault();this.pause();break;case this.CONSTANTS["LEFT_ARROW"]:case this.CONSTANTS["UP_ARROW"]:this.prev();break;case this.CONSTANTS["RIGHT_ARROW"]:case this.CONSTANTS["DOWN_ARROW"]:this.next();break}},stop:function(){if(this.timer){this.timer.stop()}if(this.hasExpose){this.hideExpose()}this.tripIndex=this.settings.tripIndex;this.hideTripBlock();this.settings.onTripStop()},pauseAndResume:function(){if(this.progressing){this.timer.pause();this.pauseProgressBar()}else{var remainingTime=this.timer.resume();this.resumeProgressBar(remainingTime)}this.progressing=!this.progressing},pause:function(){this.pauseAndResume()},resume:function(){this.pauseAndResume()},next:function(){this.tripDirection="next";if(!this.canGoNext()){return this.run()}if(this.hasCallback()){this.callCallback()}if(this.hasBeforeNext()){this.callBeforeNext()}if(this.isLast()){this.doLastOperation()}else{this.increaseIndex();this.run()}},prev:function(){this.tripDirection="prev";if(this.hasBeforePrev()){this.callBeforePrev()}if(!this.isFirst()&&this.canGoPrev()){this.decreaseIndex()}this.run()},showCurrentTrip:function(o){if(typeof o.sel==="string"){o.sel=$(o.sel)}if(this.timer){this.timer.stop()}if(this.hasExpose){this.hideExpose()}if(this.progressing){this.hideProgressBar();this.progressing=false}this.setTripBlock(o);this.showTripBlock(o);if(o.expose){this.showExpose(o.sel)}},doLastOperation:function(){if(this.timer){this.timer.stop()}if(this.settings.enableKeyBinding){this.unbindKeyEvents()}this.hideTripBlock();if(this.hasExpose){this.hideExpose()}if(this.settings.backToTopWhenEnded){this.$root.animate({scrollTop:0},"slow")}this.tripIndex=this.settings.tripIndex;this.settings.onTripEnd();return false},showProgressBar:function(delay){var that=this;this.$bar.animate({width:"100%"},delay,"linear",function(){that.$bar.width(0)})},hideProgressBar:function(){this.$bar.width(0);this.$bar.stop(true)},pauseProgressBar:function(){this.$bar.stop(true)},resumeProgressBar:function(remainingTime){this.showProgressBar(remainingTime)},run:function(){var that=this,tripObject=this.getCurrentTripObject(),delay=tripObject.delay||this.settings.delay;if(!this.isTripDataValid(tripObject)){if(this.settings.skipUndefinedTrip===false){this.console.error("Your tripData is not valid at index : "+this.tripIndex);this.stop();return false}else{return this[this.tripDirection]()}}if(this.hasBeforeShow()){this.callBeforeShow()}this.showCurrentTrip(tripObject);this.showProgressBar(delay);this.progressing=true;if(delay>=0){this.timer=new Timer(that.next.bind(that),delay)}this.settings.onTripChange(this.tripIndex,tripObject)},isFirst:function(){return this.tripIndex===0?true:false},isLast:function(){return this.tripIndex===this.tripData.length-1?true:false},isTripDataValid:function(o){if(typeof o.content==="undefined"||typeof o.sel==="undefined"||o.sel===null||o.sel.length===0||$(o.sel).length===0){return false}return true},hasCallback:function(){return typeof this.tripData[this.tripIndex].callback!=="undefined"},callCallback:function(){this.tripData[this.tripIndex].callback(this.tripIndex)},hasBeforeNext:function(){return typeof this.tripData[this.tripIndex].beforeNext!=="undefined"},callBeforeNext:function(){this.tripData[this.tripIndex].beforeNext(this.tripIndex)},hasBeforePrev:function(){return typeof this.tripData[this.tripIndex].beforePrev!=="undefined"},callBeforePrev:function(){this.tripData[this.tripIndex].beforePrev(this.tripIndex)},hasBeforeShow:function(){return typeof this.tripData[this.tripIndex].beforeShow!=="undefined"},callBeforeShow:function(){this.tripData[this.tripIndex].beforeShow(this.tripIndex)},canGoPrev:function(){var trip=this.tripData[this.tripIndex],canGoPrev=trip.canGoPrev||this.settings.canGoPrev;if(typeof canGoPrev==="function"){canGoPrev=canGoPrev.call(trip)}return canGoPrev},canGoNext:function(){var trip=this.tripData[this.tripIndex],canGoNext=trip.canGoNext||this.settings.canGoNext;if(typeof canGoNext==="function"){canGoNext=canGoNext.call(trip)}return canGoNext},increaseIndex:function(){if(this.tripIndex>=this.tripData.length-1){}else{this.tripIndex+=1}},decreaseIndex:function(){if(this.tripIndex<=0){}else{this.tripIndex-=1}},getCurrentTripObject:function(){return this.tripData[this.tripIndex]},setTripBlock:function(o){var $tripBlock=this.$tripBlock,showCloseBox=o.showCloseBox||this.settings.showCloseBox,showNavigation=o.showNavigation||this.settings.showNavigation,closeBoxLabel=o.closeBoxLabel||this.settings.closeBoxLabel,prevLabel=o.prevLabel||this.settings.prevLabel,nextLabel=o.nextLabel||this.settings.nextLabel,finishLabel=o.finishLabel||this.settings.finishLabel;$tripBlock.find(".trip-content").html(o.content);$tripBlock.find(".trip-prev").html(prevLabel).toggle(showNavigation&&!this.isFirst());$tripBlock.find(".trip-next").html(this.isLast()?finishLabel:nextLabel).toggle(showNavigation);$tripBlock.find(".trip-close").html(closeBoxLabel).toggle(showCloseBox);$tripBlock.css("max-width",o.width||"");var $sel=o.sel,selWidth=$sel.outerWidth(),selHeight=$sel.outerHeight(),blockWidth=$tripBlock.outerWidth(),blockHeight=$tripBlock.outerHeight(),arrowHeight=10,arrowWidth=10;$tripBlock.removeClass("e s w n");switch(o.position){case"e":$tripBlock.addClass("e");$tripBlock.css({left:$sel.offset().left+selWidth+arrowWidth,top:$sel.offset().top-(blockHeight-selHeight)/2});break;case"s":$tripBlock.addClass("s");$tripBlock.css({left:$sel.offset().left+(selWidth-blockWidth)/2,top:$sel.offset().top+selHeight+arrowHeight});break;case"w":$tripBlock.addClass("w");$tripBlock.css({left:$sel.offset().left-(arrowWidth+blockWidth),top:$sel.offset().top-(blockHeight-selHeight)/2});break;case"n":default:$tripBlock.addClass("n");$tripBlock.css({left:$sel.offset().left+(selWidth-blockWidth)/2,top:$sel.offset().top-arrowHeight-blockHeight});break}},showTripBlock:function(o){this.$tripBlock.css({display:"inline-block",zIndex:this.settings.overlayZindex+1});var windowHeight=$(window).height(),windowTop=$(window).scrollTop(),tripBlockTop=this.$tripBlock.offset().top,OFFSET=100;if(tripBlockTop<windowTop+windowHeight&&tripBlockTop>=windowTop){}else{this.$root.animate({scrollTop:tripBlockTop-OFFSET},"slow")}},hideTripBlock:function(){this.$tripBlock.fadeOut("slow")},create:function(){this.createTripBlock();this.createOverlay()},createTripBlock:function(){if(typeof $(".trip-block").get(0)==="undefined"){var html=['<div class="trip-block">','<a href="#" class="trip-close"></a>','<div class="trip-content"></div>','<div class="trip-progress-wrapper">','<div class="trip-progress-bar"></div>','<a href="#" class="trip-prev"></a>','<a href="#" class="trip-next"></a>',"</div>","</div>"].join("");var that=this,$tripBlock=$(html).addClass(this.settings.tripTheme);$("body").append($tripBlock);$tripBlock.find(".trip-close").on("click",function(e){e.preventDefault();that.stop()});$tripBlock.find(".trip-prev").on("click",function(e){e.preventDefault();that.prev()});$tripBlock.find(".trip-next").on("click",function(e){e.preventDefault();that.next()})}},createOverlay:function(){if(typeof $(".trip-overlay").get(0)==="undefined"){var html=['<div class="trip-overlay">',"</div>"].join("");var $overlay=$(html);$overlay.height($(window).height()).css({zIndex:this.settings.overlayZindex});$("body").append($overlay)}},cleanup:function(){$(".trip-overlay, .trip-block").remove()},init:function(){this.preInit();if(this.settings.enableKeyBinding){this.bindKeyEvents()}this.bindResizeEvents();this.$tripBlock=$(".trip-block");this.$bar=$(".trip-progress-bar");this.$overlay=$(".trip-overlay")},start:function(){this.cleanup();this.settings.onTripStart();this.create();this.init();this.run()}};window.Trip=Trip;function Timer(e,t){var n,r,i=t;this.pause=function(){window.clearTimeout(n);i-=new Date-r};this.resume=function(){r=new Date;n=window.setTimeout(e,i);return i};this.stop=function(){window.clearTimeout(n)};this.resume()}})(window,jQuery);